{% extends "store_base.html" %}
{% block content %}
<style>
    .auth-wrapper { min-height: 80vh; display: flex; align-items: center; justify-content: center; padding: 40px 20px; }
    .auth-card { width: 100%; max-width: 450px; }
    .form-group { margin-bottom: 20px; position: relative; }
    .form-label { display: block; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.5px; }
    .form-input { width: 100%; padding: 14px; border: 1px solid #e5e5e5; border-radius: 4px; box-sizing: border-box; font-size: 14px; transition: 0.2s; }
    .form-input:focus { border-color: black; outline: none; }
    
    .btn-auth { width: 100%; background: black; color: white; padding: 16px; border-radius: 30px; border: none; cursor: pointer; font-weight: 700; transition: 0.2s; margin-top: 20px; }
    .btn-auth:hover { opacity: 0.8; }
    .btn-auth:disabled { background: #e5e5e5; color: #999; cursor: not-allowed; opacity: 1; }

    /* Validation Styles */
    .req-list { list-style: none; padding: 0; margin-top: 8px; font-size: 11px; color: #666; display: flex; flex-direction: column; gap: 4px; }
    .req-item { display: flex; align-items: center; gap: 6px; transition: color 0.2s; }
    .req-item i { font-size: 8px; }
    .valid { color: #16a34a; }
    .invalid { color: #dc2626; }
    .match-msg { font-size: 11px; margin-top: 6px; font-weight: 600; }
    
    .header-text { margin-bottom: 30px; text-align: center; }
    .header-text h2 { font-size: 26px; font-weight: 900; margin-bottom: 10px; letter-spacing: -1px; }
    .header-text p { color: #666; font-size: 14px; line-height: 1.5; }
</style>

<div class="auth-wrapper">
    <div class="auth-card">
        <div class="header-text">
            <h2>FINISH SETUP</h2>
            <p>Welcome, <strong>{{ g.user.first_name }}</strong>! Secure your account with a password and phone number.</p>
        </div>

        <form method="POST" id="setupForm">
            
            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" name="phone" class="form-input" placeholder="+65 9123 4567" required>
            </div>

            <div class="form-group">
                <label class="form-label">Create Password</label>
                <input type="password" id="password" name="password" class="form-input" required placeholder="Min 8 chars, 1 Uppercase, 1 Number">
                <ul class="req-list">
                    <li id="req-len" class="req-item"><i class="fa-solid fa-circle"></i> Minimum 8 characters</li>
                    <li id="req-upper" class="req-item"><i class="fa-solid fa-circle"></i> Uppercase letter</li>
                    <li id="req-num" class="req-item"><i class="fa-solid fa-circle"></i> Number</li>
                </ul>
            </div>

            <div class="form-group">
                <label class="form-label">Confirm Password</label>
                <input type="password" id="confirm_password" name="confirm_password" class="form-input" required placeholder="Re-enter Password">
                <div id="match-msg" class="match-msg" style="display: none;"></div>
            </div>

            <button type="submit" id="submitBtn" class="btn-auth" disabled>SAVE & VERIFY</button>
        </form>
    </div>
</div>

<script>
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirm_password');
    const submitBtn = document.getElementById('submitBtn');
    const matchMsg = document.getElementById('match-msg');

    const reqLen = document.getElementById('req-len');
    const reqUpper = document.getElementById('req-upper');
    const reqNum = document.getElementById('req-num');

    function validate() {
        const val = passwordInput.value;
        const confirmVal = confirmInput.value;

        // Requirements
        const hasLen = val.length >= 8;
        const hasUpper = /[A-Z]/.test(val);
        const hasNum = /\d/.test(val);
        const isMatch = val === confirmVal && val.length > 0;

        // UI Updates
        updateReq(reqLen, hasLen);
        updateReq(reqUpper, hasUpper);
        updateReq(reqNum, hasNum);

        // Match Msg
        if (confirmVal.length > 0) {
            matchMsg.style.display = 'block';
            if (isMatch) {
                matchMsg.textContent = "Passwords match";
                matchMsg.className = "match-msg valid";
            } else {
                matchMsg.textContent = "Passwords do not match";
                matchMsg.className = "match-msg invalid";
            }
        } else {
            matchMsg.style.display = 'none';
        }

        // Button State
        if (hasLen && hasUpper && hasNum && isMatch) {
            submitBtn.disabled = false;
        } else {
            submitBtn.disabled = true;
        }
    }

    function updateReq(el, isValid) {
        const icon = el.querySelector('i');
        if (isValid) {
            el.classList.add('valid');
            el.classList.remove('invalid');
            icon.className = 'fa-solid fa-check';
        } else {
            if (passwordInput.value.length > 0) {
                el.classList.remove('valid');
            } else {
                el.classList.remove('valid');
                el.classList.remove('invalid');
            }
            icon.className = 'fa-solid fa-circle';
        }
    }

    passwordInput.addEventListener('input', validate);
    confirmInput.addEventListener('input', validate);
</script>
{% endblock %}