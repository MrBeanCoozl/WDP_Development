{% extends "base.html" %}

{% block header %}
    Invoices Management
{% endblock %}

{% block content %}

<style>
    .filter-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 25px; display: flex; flex-wrap: wrap; gap: 15px; align-items: center; border: 1px solid #eee; }
    .filter-group { display: flex; flex-direction: column; gap: 5px; }
    .filter-label { font-size: 12px; font-weight: 600; color: #7f8c8d; text-transform: uppercase; }
    .filter-input, .filter-select { padding: 10px 12px; border: 1px solid #dcdcdc; border-radius: 6px; font-size: 14px; min-width: 150px; }
    
    .btn-filter { background-color: #34495e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: auto; height: 42px; }
    .btn-reset { background-color: #ecf0f1; color: #7f8c8d; border: 1px solid #bdc3c7; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: auto; height: 42px; text-decoration: none; display: flex; align-items: center; }
    
    .table-container { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; }
    .table { width: 100%; border-collapse: collapse; }
    .table th { background-color: #f8f9fa; color: #2d3436; font-weight: 700; padding: 15px; text-align: left; border-bottom: 2px solid #dfe6e9; }
    .table td { padding: 15px; border-bottom: 1px solid #f1f2f6; color: #636e72; vertical-align: middle; }
    
    /* UPDATED BADGE STYLES */
    .badge { padding: 5px 12px; border-radius: 15px; font-size: 11px; font-weight: 800; text-transform: uppercase; display: inline-block; letter-spacing: 0.5px; }
    .badge-Paid { background-color: #dcfce7; color: #166534; }
    .badge-Pending { background-color: #fef9c3; color: #854d0e; }
    .badge-Cancelled { background-color: #fee2e2; color: #991b1b; text-decoration: line-through; }
    .badge-Expired { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
    
    .action-group { display: flex; gap: 8px; justify-content: center; }
    .btn-view { padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; font-weight: 600; background-color: #e5e7eb; color: #374151; transition: 0.2s; }
    .btn-view:hover { background-color: #d1d5db; }
    .btn-edit { padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; font-weight: 600; background-color: #34495e; color: white; transition: 0.2s; }
    .btn-edit:hover { background-color: #2c3e50; }
</style>

<form method="GET" action="{{ url_for('invoices') }}" class="filter-container">
    <div class="filter-group" style="flex: 1; min-width: 250px;">
        <label class="filter-label">Search</label>
        <input type="text" name="search" class="filter-input" placeholder="Invoice # or Client Name..." value="{{ request.args.get('search', '') }}">
    </div>
    <div class="filter-group">
        <label class="filter-label">Status</label>
        <select name="status" class="filter-select">
            <option value="All" {% if request.args.get('status') == 'All' %}selected{% endif %}>All Statuses</option>
            <option value="Paid" {% if request.args.get('status') == 'Paid' %}selected{% endif %}>Paid</option>
            <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
            <option value="Cancelled" {% if request.args.get('status') == 'Cancelled' %}selected{% endif %}>Cancelled</option>
            <option value="Expired" {% if request.args.get('status') == 'Expired' %}selected{% endif %}>Expired</option>
        </select>
    </div>
    <div class="filter-group">
        <label class="filter-label">Sort By</label>
        <select name="sort" class="filter-select">
            <option value="date_desc" {% if request.args.get('sort') == 'date_desc' %}selected{% endif %}>Newest First</option>
            <option value="date_asc" {% if request.args.get('sort') == 'date_asc' %}selected{% endif %}>Oldest First</option>
            <option value="amount_high" {% if request.args.get('sort') == 'amount_high' %}selected{% endif %}>Amount: High to Low</option>
            <option value="amount_low" {% if request.args.get('sort') == 'amount_low' %}selected{% endif %}>Amount: Low to High</option>
        </select>
    </div>
    <button type="submit" class="btn-filter">Apply</button>
    <a href="{{ url_for('invoices') }}" class="btn-reset">Reset</a>
</form>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Invoice #</th>
                <th>Client</th>
                <th>Amount</th>
                <th>Created</th>
                <th>Due Date</th>
                <th style="text-align: center;">Status</th>
                <th style="text-align: center;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoices.items %}
            <tr>
                <td style="font-weight: bold; color: #2c3e50;">{{ invoice.invoice_code }}</td>
                <td>{{ invoice.client.name }}</td>
                <td style="font-weight: bold;">${{ "%.2f"|format(invoice.amount) }}</td>
                <td>{{ invoice.date_created.strftime('%Y-%m-%d') }}</td>
                <td>{{ invoice.date_due.strftime('%Y-%m-%d') if invoice.date_due else 'N/A' }}</td>
                <td style="text-align: center;">
                    <span class="badge badge-{{ invoice.status }}">{{ invoice.status }}</span>
                </td>
                <td style="text-align: center;">
                    <div class="action-group">
                        <a href="{{ url_for('view_invoice', invoice_id=invoice.id) }}" class="btn-view">View</a>
                        <a href="{{ url_for('edit_invoice', invoice_id=invoice.id) }}" class="btn-edit">Edit</a>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 30px; color: #999;">
                    No invoices found matching your criteria.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
    <div style="font-size: 14px; color: #7f8c8d;">
        Showing page <strong>{{ invoices.page }}</strong> of {{ invoices.pages }}
    </div>
    
    <div style="display: flex; gap: 5px;">
        {% if invoices.has_prev %}
            <a href="{{ url_for('invoices', page=invoices.prev_num, search=request.args.get('search', ''), status=request.args.get('status', 'All'), sort=request.args.get('sort', 'date_desc')) }}" 
               style="padding: 8px 12px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #333; font-size: 13px;">
               Previous
            </a>
        {% endif %}

        {% for item in invoices | smart_pagination %}
            {% if item.type == 'page' %}
                <a href="{{ url_for('invoices', page=item.page, search=request.args.get('search', ''), status=request.args.get('status', 'All'), sort=request.args.get('sort', 'date_desc')) }}" 
                   style="padding: 8px 14px; border-radius: 4px; text-decoration: none; font-size: 13px; 
                          {{ 'background: #34495e; color: white;' if item.page == invoices.page else 'background: white; color: #333; border: 1px solid #ddd;' }}">
                    {{ item.page }}
                </a>
            {% else %}
                <a href="{{ url_for('invoices', page=item.page, search=request.args.get('search', ''), status=request.args.get('status', 'All'), sort=request.args.get('sort', 'date_desc')) }}" 
                   title="Jump to middle (Page {{ item.page }})"
                   style="padding: 8px 12px; border-radius: 4px; text-decoration: none; font-size: 13px; background: #f8f9fa; color: #7f8c8d; border: 1px solid #ddd;">
                    ...
                </a>
            {% endif %}
        {% endfor %}

        {% if invoices.has_next %}
            <a href="{{ url_for('invoices', page=invoices.next_num, search=request.args.get('search', ''), status=request.args.get('status', 'All'), sort=request.args.get('sort', 'date_desc')) }}" 
               style="padding: 8px 12px; background: #f8f9fa; border: 1px solid #ddd; border-radius: 4px; text-decoration: none; color: #333; font-size: 13px;">
               Next
            </a>
        {% endif %}
    </div>
</div>

{% endblock %}