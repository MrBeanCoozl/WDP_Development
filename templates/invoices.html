{% extends "base.html" %}

{% block header %}
    Invoices Management
{% endblock %}

{% block content %}

<style>
    /* Filter Bar Styles */
    .filter-container {
        background: white; padding: 20px; border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 25px;
        display: flex; flex-wrap: wrap; gap: 15px; align-items: center; border: 1px solid #eee;
    }
    .filter-group { display: flex; flex-direction: column; gap: 5px; }
    .filter-label { font-size: 12px; font-weight: 600; color: #7f8c8d; text-transform: uppercase; }
    .filter-input, .filter-select { padding: 10px 12px; border: 1px solid #dcdcdc; border-radius: 6px; font-size: 14px; min-width: 150px; }
    .btn-filter { background-color: #34495e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: auto; height: 42px; }
    .btn-filter:hover { background-color: #2c3e50; }
    .btn-reset { background-color: #ecf0f1; color: #7f8c8d; border: 1px solid #bdc3c7; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: auto; height: 42px; text-decoration: none; display: flex; align-items: center; }
    
    /* Table Styles (Matched to Orders) */
    .table-container {
        background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden;
    }
    .table {
        width: 100%; border-collapse: collapse;
    }
    .table th { background-color: #f8f9fa; color: #2d3436; font-weight: 700; padding: 15px; text-align: left; border-bottom: 2px solid #dfe6e9; }
    .table td { padding: 15px; border-bottom: 1px solid #f1f2f6; color: #636e72; vertical-align: middle; }
    .table tr:hover { background-color: #fcfcfc; }

    /* High Contrast Badges (Standardized Scheme) */
    .badge {
        padding: 5px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;
        text-transform: uppercase; display: inline-block;
    }
    
    /* Matches 'Invoiced' from Orders */
    .badge-Paid { 
        background-color: #a5d6a7; /* Deeper Soft Green */
        color: #1b5e20;            /* Dark Green Text */
    }
    
    /* Matches 'Pending' from Orders */
    .badge-Pending { 
        background-color: #ffe082; /* Deeper Amber */
        color: #5d4037;            /* Dark Brown Text */
    }
    
    /* Blue Adjusted for Contrast */
    .badge-Sent { 
        background-color: #90caf9; /* Soft Blue */
        color: #0d47a1;            /* Dark Blue Text */
    }
    
    /* Red Adjusted for Contrast */
    .badge-Overdue { 
        background-color: #ef9a9a; /* Soft Red */
        color: #b71c1c;            /* Dark Red Text */
    }
    
    /* Grey Adjusted for Contrast */
    .badge-Draft { 
        background-color: #cfd8dc; /* Soft Blue Grey */
        color: #37474f;            /* Dark Grey Text */
    }

    /* Action Buttons */
    .btn-view { 
        padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 13px; font-weight: 600;
        transition: 0.2s; display: inline-block;
        background-color: #636e72; color: white; 
    }
    .btn-view:hover { background-color: #2d3436; }

</style>

<form method="GET" action="{{ url_for('invoices') }}" class="filter-container">
    <div class="filter-group" style="flex: 1; min-width: 250px;">
        <label class="filter-label">Search</label>
        <input type="text" name="search" class="filter-input" placeholder="Invoice # or Client Name..." value="{{ request.args.get('search', '') }}">
    </div>
    <div class="filter-group">
        <label class="filter-label">Status</label>
        <select name="status" class="filter-select">
            <option value="All" {% if request.args.get('status') == 'All' %}selected{% endif %}>All Statuses</option>
            <option value="Paid" {% if request.args.get('status') == 'Paid' %}selected{% endif %}>Paid</option>
            <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
            <option value="Sent" {% if request.args.get('status') == 'Sent' %}selected{% endif %}>Sent</option>
            <option value="Overdue" {% if request.args.get('status') == 'Overdue' %}selected{% endif %}>Overdue</option>
        </select>
    </div>
    <div class="filter-group">
        <label class="filter-label">Sort By</label>
        <select name="sort" class="filter-select">
            <option value="date_desc" {% if request.args.get('sort') == 'date_desc' %}selected{% endif %}>Newest First</option>
            <option value="date_asc" {% if request.args.get('sort') == 'date_asc' %}selected{% endif %}>Oldest First</option>
            <option value="amount_high" {% if request.args.get('sort') == 'amount_high' %}selected{% endif %}>Amount: High to Low</option>
            <option value="amount_low" {% if request.args.get('sort') == 'amount_low' %}selected{% endif %}>Amount: Low to High</option>
        </select>
    </div>
    <button type="submit" class="btn-filter">Apply</button>
    <a href="{{ url_for('invoices') }}" class="btn-reset">Reset</a>
</form>

<div class="table-container">
    <table class="table">
        <thead>
            <tr>
                <th>Invoice #</th>
                <th>Client</th>
                <th>Amount</th>
                <th>Created</th>
                <th>Due Date</th>
                <th style="text-align: center;">Status</th>
                <th style="text-align: center;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoices %}
            <tr>
                <td style="font-weight: bold; color: #2c3e50;">{{ invoice.invoice_code }}</td>
                <td>{{ invoice.client.name }}</td>
                <td style="font-weight: bold;">${{ "%.2f"|format(invoice.amount) }}</td>
                <td>{{ invoice.date_created.strftime('%Y-%m-%d') }}</td>
                <td>{{ invoice.date_due.strftime('%Y-%m-%d') }}</td>
                
                <td style="text-align: center;">
                    <span class="badge badge-{{ invoice.status }}">{{ invoice.status }}</span>
                </td>
                
                <td style="text-align: center;">
                    <a href="{{ url_for('view_invoice', invoice_id=invoice.id) }}" class="btn-view">
                        View
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" style="text-align: center; padding: 30px; color: #999;">
                    No invoices found matching your criteria.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}