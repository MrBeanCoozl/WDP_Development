{% extends "base.html" %}

{% block header %}{{ 'Edit Product' if product else 'Add New Product' }}{% endblock %}

{% block content %}
<style>
    .back-link { display: inline-block; color: #7f8c8d; text-decoration: none; font-weight: 600; font-size: 14px; margin-bottom: 20px; transition: 0.2s; }
    .back-link:hover { color: #2c3e50; }
    .back-link i { margin-right: 5px; }

    .form-card { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 900px; }
    
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .form-group { display: flex; flex-direction: column; gap: 8px; }
    .form-group.full-width { grid-column: span 2; }
    
    .form-label { font-size: 12px; font-weight: 700; color: #2c3e50; text-transform: uppercase; letter-spacing: 0.5px; }
    .form-control { padding: 12px 15px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 14px; font-family: inherit; transition: 0.2s; background: #fff; width: 100%; box-sizing: border-box; }
    .form-control:focus { border-color: #3498db; outline: none; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
    textarea.form-control { resize: vertical; min-height: 120px; }
    
    .help-text { font-size: 11px; color: #7f8c8d; margin-top: 4px; }
    
    .img-upload-area { background: #f4f7f6; border: 1px dashed #bdc3c7; padding: 20px; border-radius: 4px; margin-bottom: 30px; }
    .current-images { display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap; }
    .current-images img { width: 80px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid #bdc3c7; background: white; padding: 2px; }
    
    .btn-submit { padding: 15px; font-size: 14px; font-weight: bold; width: 100%; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; }
</style>

<a href="{{ url_for('admin_products') }}" class="back-link"><i class="fa-solid fa-arrow-left"></i> Back to Products</a>

<div class="form-card">
    <form action="{{ url_for('admin_product_edit', prod_id=product.id) if product else url_for('admin_product_new') }}" method="POST" enctype="multipart/form-data">
        
        <div class="form-grid">
            <div class="form-group" style="grid-column: span 1.5;">
                <label class="form-label">Product Name</label>
                <input type="text" name="name" class="form-control" value="{{ product.name if product else '' }}" required>
            </div>
            
            <div class="form-group" style="grid-column: span 0.5;">
                <label class="form-label">Category</label>
                <select name="category" class="form-control" required>
                    <option value="Casual" {% if product and product.category == 'Casual' %}selected{% endif %}>Casual</option>
                    <option value="Formal" {% if product and product.category == 'Formal' %}selected{% endif %}>Formal</option>
                    <option value="Shoes" {% if product and product.category == 'Shoes' %}selected{% endif %}>Shoes</option>
                    <option value="Accessories" {% if product and product.category == 'Accessories' %}selected{% endif %}>Accessories</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Price ($)</label>
                <input type="number" step="0.01" name="price" class="form-control" value="{{ product.price if product else '' }}" required>
            </div>

            <div class="form-group">
                <label class="form-label">Stock Quantity</label>
                <input type="number" name="stock" class="form-control" value="{{ product.stock if product else '100' }}" required>
            </div>

            <div class="form-group full-width">
                <label class="form-label">Description</label>
                <textarea name="description" class="form-control">{{ product.description if product else '' }}</textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Sizes (Comma separated)</label>
                <input type="text" name="sizes" class="form-control" value="{{ product.sizes if product else '' }}" placeholder="e.g. S, M, L, XL">
                <div class="help-text">Leave blank if One Size.</div>
            </div>

            <div class="form-group">
                <label class="form-label">Colors (Comma separated)</label>
                <input type="text" name="colors" class="form-control" value="{{ product.colors if product else '' }}" placeholder="e.g. Black, White, Navy">
                <div class="help-text">Leave blank if no color variants.</div>
            </div>
        </div>

        <div class="img-upload-area">
            <label class="form-label"><i class="fa-solid fa-image"></i> Product Images</label>
            <input type="file" name="images" class="form-control" style="background: white;" accept="image/*" multiple {% if not product %}required{% endif %}>
            <div class="help-text">Hold Ctrl/Cmd to select multiple images. {% if product %}<strong>Uploading new images will replace existing ones.</strong>{% endif %}</div>
            
            {% if product and product.image_url %}
            <div style="margin-top: 20px;">
                <span class="form-label" style="font-size: 11px;">Current Images:</span>
                <div class="current-images">
                    {% for img in product.image_url.split('|') %}
                        {% set img_src = img.strip() %}
                        {% if not img_src.startswith('http') %}
                            {% set img_src = url_for('static', filename='product_images/' + img_src) %}
                        {% endif %}
                        <img src="{{ img_src }}" alt="Product Image">
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary btn-submit">
            <i class="fa-solid fa-floppy-disk" style="margin-right: 8px;"></i> {{ 'Save Changes' if product else 'Publish Product' }}
        </button>
    </form>
</div>
{% endblock %}