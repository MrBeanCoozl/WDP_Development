{% extends "base.html" %}

{% block header %}Product Management{% endblock %}

{% block content %}
<style>
    /* Admin Product List Styles */
    .admin-top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    
    .search-form { display: flex; gap: 10px; width: 400px; }
    .search-input { flex: 1; padding: 10px 15px; border: 1px solid #bdc3c7; border-radius: 4px; outline: none; font-size: 14px; }
    .search-input:focus { border-color: #3498db; }
    
    .admin-table-container { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow-x: auto; }
    .admin-table { width: 100%; border-collapse: collapse; min-width: 800px; }
    .admin-table th, .admin-table td { padding: 15px 20px; text-align: left; border-bottom: 1px solid #ecf0f1; vertical-align: middle; }
    .admin-table th { background-color: #f8f9fa; color: #2c3e50; font-weight: 700; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; }
    .admin-table tr:hover { background-color: #fbfcfc; }
    .admin-table tr:last-child td { border-bottom: none; }
    
    .prod-img-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #eee; }
    
    .badge-cat { background: #ecf0f1; color: #7f8c8d; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
    .text-danger { color: #e74c3c; font-weight: bold; }
    .text-success { color: #27ae60; font-weight: bold; }
    
    .action-btns { display: flex; gap: 8px; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    
    .pagination { display: flex; list-style: none; gap: 5px; justify-content: center; padding: 20px; background: white; border-top: 1px solid #ecf0f1; border-radius: 0 0 8px 8px; }
    .page-link { display: block; padding: 8px 12px; background: white; border: 1px solid #bdc3c7; border-radius: 4px; color: #2c3e50; text-decoration: none; font-size: 13px; font-weight: bold; transition: 0.2s; }
    .page-link:hover, .page-item.active .page-link { background: #3498db; color: white; border-color: #3498db; }
    .page-item.disabled .page-link { color: #bdc3c7; border-color: #ecf0f1; background: #fdfdfd; pointer-events: none; }
</style>

<div class="admin-top-bar">
    <form method="GET" action="{{ url_for('admin_products') }}" class="search-form">
        <input type="text" name="q" class="search-input" placeholder="Search by name or category..." value="{{ request.args.get('q', '') }}">
        <button type="submit" class="btn btn-primary">Search</button>
        {% if request.args.get('q') %}
            <a href="{{ url_for('admin_products') }}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
    
    <a href="{{ url_for('admin_product_new') }}" class="btn btn-success">
        <i class="fa-solid fa-plus"></i> New Product
    </a>
</div>

<div class="admin-table-container">
    <table class="admin-table">
        <thead>
            <tr>
                <th style="width: 70px;">Image</th>
                <th>Product Details</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Sales</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for p in products.items %}
            <tr>
                <td>
                    {% set img_src = p.image_url.split('|')[0].strip() if p.image_url else 'default.jpg' %}
                    {% if not img_src.startswith('http') %}
                        {% set img_src = url_for('static', filename='product_images/' + img_src) %}
                    {% endif %}
                    <img src="{{ img_src }}" alt="Img" class="prod-img-thumb">
                </td>
                <td>
                    <strong style="color: #2c3e50; font-size: 14px;">{{ p.name }}</strong>
                    <div style="font-size: 11px; color: #7f8c8d; margin-top: 4px;">ID: {{ p.id }}</div>
                </td>
                <td><span class="badge-cat">{{ p.category }}</span></td>
                <td style="font-weight: 600; color: #2c3e50;">${{ "%.2f"|format(p.price) }}</td>
                <td>
                    {% if p.stock <= 5 %}
                        <span class="text-danger"><i class="fa-solid fa-circle-exclamation"></i> {{ p.stock }}</span>
                    {% else %}
                        <span class="text-success">{{ p.stock }}</span>
                    {% endif %}
                </td>
                <td style="color: #7f8c8d;">{{ p.sales_count }}</td>
                <td>
                    <div class="action-btns">
                        <a href="{{ url_for('admin_product_edit', prod_id=p.id) }}" class="btn btn-primary btn-sm"><i class="fa-solid fa-pen"></i></a>
                        <form action="{{ url_for('admin_product_delete', prod_id=p.id) }}" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
                            <button type="submit" class="btn btn-danger btn-sm"><i class="fa-solid fa-trash"></i></button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="7" style="text-align: center; padding: 40px; color: #7f8c8d;">No products found in the database.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if products.pages > 1 %}
    <ul class="pagination">
        {% for page_num in products.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
            {% if page_num %}
                <li class="page-item {% if page_num == products.page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('admin_products', page=page_num, q=request.args.get('q','')) }}">{{ page_num }}</a>
                </li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
    </ul>
    {% endif %}
</div>
{% endblock %}