{% extends "store_base.html" %}

{% block title %}Shop.co | Redefine Luxury{% endblock %}

{% block content %}

<style>
    .flying-img {
        position: fixed;
        z-index: 9999;
        border-radius: 50%;
        opacity: 0.9;
        pointer-events: none;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
    }
</style>

<section style="position: relative; height: 90vh; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #000;">
    <div style="position: absolute; inset: 0; opacity: 0.6;">
        <img src="https://images.unsplash.com/photo-1469334031218-e382a71b716b?q=80&w=2070&auto=format&fit=crop" 
             style="width: 100%; height: 100%; object-fit: cover; animation: slowZoom 20s infinite alternate;">
    </div>
    
    <div class="container animate-up" style="position: relative; z-index: 2; text-align: center; color: white; max-width: 800px;">
        <span style="display: block; font-size: 11px; font-weight: 600; letter-spacing: 4px; text-transform: uppercase; margin-bottom: 25px; opacity: 0.8;">
            Spring / Summer 2026
        </span>
        <h1 style="font-size: clamp(36px, 5vw, 60px); font-weight: 800; line-height: 1.1; margin: 0 0 35px; text-transform: uppercase; letter-spacing: -1px;">
            Redefine<br>Your Style.
        </h1>
        <div>
            <a href="{{ url_for('store_shop') }}" class="hero-btn">
                Shop Collection
            </a>
        </div>
    </div>
</section>

<div class="marquee-container">
    <div class="marquee-track">
        {% for i in range(3) %}
        <span class="marquee-item">New Arrivals Dropping Daily</span> •
        <span class="marquee-item">Free Worldwide Shipping</span> •
        <span class="marquee-item">Shop.co Exclusive Drops</span> •
        <span class="marquee-item">Luxury Essentials</span> •
        {% endfor %}
    </div>
</div>

<section class="section-pad bg-white">
    <div class="container header-flex">
        <h2 class="section-title">New Arrivals</h2>
        <a href="{{ url_for('store_shop') }}" class="view-all-link">View All Arrivals</a>
    </div>

    <div class="container">
        <div class="static-grid">
            {% for product in new_arrivals %}
            <div class="product-card">
                <div class="card-image-wrap">
                    <a href="{{ url_for('store_product', product_id=product.id) }}">
                        {% set first_raw = product.image_url.split('|')[0].strip() if product.image_url else 'default.jpg' %}
                        {% set img_src = first_raw if first_raw.startswith('http') else url_for('static', filename='product_images/' + first_raw) %}
                        
                        <img src="{{ img_src }}" 
                        data-photos="{{ product.image_url }}"
                        class="looping-image" 
                        alt="{{ product.name }}"
                        style="width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s;">
                    </a>
                    <form action="{{ url_for('store_cart') }}" method="POST" class="ajax-cart-form" data-id="{{ product.id }}" data-prefix="home-">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="quick-add-icon" title="Add to Cart">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </form>
                    <span class="badge-new">New</span>
                </div>
                <a href="{{ url_for('store_product', product_id=product.id) }}" class="card-info">
                    <div class="card-cat">{{ product.category }}</div>
                    <h3 class="card-name">{{ product.name }}</h3>
                    <div class="card-meta">
                        <span class="card-rating">
                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i>
                        </span>
                        <span class="card-sold">{{ product.sales_count }} sold</span>
                    </div>
                    <div class="card-price">${{ "%.2f"|format(product.price) }}</div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<section class="section-pad bg-light">
    <div class="container header-flex">
        <div>
            <h2 class="section-title">Top Selling</h2>
            <p style="color: #666; margin-top: 5px; font-size: 14px; margin-bottom: 0;">Curated favorites of the season.</p>
        </div>
        <a href="{{ url_for('store_shop') }}" class="view-all-link">View All Best Sellers</a>
    </div>

    <div class="container">
        <div class="static-grid">
            {% for product in top_selling %}
            <div class="product-card">
                <div class="card-image-wrap">
                    <a href="{{ url_for('store_product', product_id=product.id) }}">
                        {% set first_raw = product.image_url.split('|')[0].strip() if product.image_url else 'default.jpg' %}
                        {% set img_src = first_raw if first_raw.startswith('http') else url_for('static', filename='product_images/' + first_raw) %}
                        
                        <img src="{{ img_src }}" 
                        data-photos="{{ product.image_url }}"
                        class="looping-image" 
                        alt="{{ product.name }}"
                        style="width: 100%; height: 100%; object-fit: cover; transition: opacity 0.3s;">
                    </a>
                    <form action="{{ url_for('store_cart') }}" method="POST" class="ajax-cart-form" data-id="{{ product.id }}" data-prefix="top-">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="hidden" name="quantity" value="1">
                        <button type="submit" class="quick-add-icon" title="Add to Cart">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </form>
                    <span class="badge-hot">Hot</span>
                </div>
                <a href="{{ url_for('store_product', product_id=product.id) }}" class="card-info">
                    <div class="card-cat">{{ product.category }}</div>
                    <h3 class="card-name">{{ product.name }}</h3>
                    <div class="card-meta">
                        <span class="card-rating">
                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i class="fa-solid fa-star-half-stroke"></i>
                        </span>
                        <span class="card-sold">{{ product.sales_count }} sold</span>
                    </div>
                    <div class="card-price">${{ "%.2f"|format(product.price) }}</div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<section class="section-pad" style="margin-top: 40px; margin-bottom: 40px;">
    <div class="bento-container">
        <div class="text-center mb-50">
            <span style="display: block; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; color: #888; margin-bottom: 12px;">The Collections</span>
            <h2 class="section-title" style="font-size: 40px; letter-spacing: -1.5px;">Explore Categories</h2>
        </div>
        
        <div class="editorial-bento">
            <a href="{{ url_for('store_shop', category='Formal') }}" class="ed-item feature-main">
                <div class="ed-image-wrap">
                    <img src="https://images.unsplash.com/photo-1507679799987-c73779587ccf?q=80&w=1200&auto=format&fit=crop" alt="Formal Collection">
                </div>
                <div class="ed-overlay">
                    <div class="ed-content">
                        <h3>Formal Edit</h3>
                        <p>Elevated tailoring and sharp silhouettes for the modern professional.</p>
                        <span class="ed-link">Discover <i class="fa-solid fa-arrow-right-long"></i></span>
                    </div>
                </div>
            </a>
            
            <a href="{{ url_for('store_shop', category='Casual') }}" class="ed-item feature-horizontal">
                <div class="ed-image-wrap">
                    <img src="https://images.unsplash.com/photo-1523381210434-271e8be1f52b?auto=format&fit=crop&w=1000&q=80" alt="Casual Essentials">
                </div>
                <div class="ed-overlay">
                    <div class="ed-content">
                        <h3>Casual Essentials</h3>
                        <p>Relaxed fits crafted from premium, breathable fabrics.</p>
                        <span class="ed-link">Discover <i class="fa-solid fa-arrow-right-long"></i></span>
                    </div>
                </div>
            </a>
            
            <a href="{{ url_for('store_shop', category='Shoes') }}" class="ed-item feature-square">
                <div class="ed-image-wrap">
                    <img src="https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=800&q=80" alt="Shoes">
                </div>
                <div class="ed-overlay">
                    <div class="ed-content">
                        <h3>Footwear</h3>
                        <span class="ed-link">Discover <i class="fa-solid fa-arrow-right-long"></i></span>
                    </div>
                </div>
            </a>
            
            <a href="{{ url_for('store_shop', category='Accessories') }}" class="ed-item feature-square">
                <div class="ed-image-wrap">
                    <img src="https://images.unsplash.com/photo-1588850561407-ed78c282e89b?auto=format&fit=crop&w=800&q=80" alt="Accessories">
                </div>
                <div class="ed-overlay">
                    <div class="ed-content">
                        <h3>Accessories</h3>
                        <span class="ed-link">Discover <i class="fa-solid fa-arrow-right-long"></i></span>
                    </div>
                </div>
            </a>
        </div>
    </div>
</section>

<section class="section-pad bg-light overflow-hidden text-center" style="border-top: 1px solid #eaeaea;">
    <h2 class="section-title mb-10">Client Experiences</h2>
    <p class="text-muted mb-40">Trusted by style enthusiasts worldwide.</p>

    <div class="reviews-marquee-container">
        <div class="reviews-track" style="animation-duration: 80s;">
            {% for i in range(2) %}
                <div class="review-card">
                    <div class="stars">★★★★★</div>
                    <h4>"Unmatched Quality"</h4>
                    <p>The materials and cuts are absolutely premium. Worth every penny.</p>
                    <div class="reviewer">James D. <i class="fa-solid fa-certificate"></i></div>
                </div>
                <div class="review-card">
                    <div class="stars">★★★★★</div>
                    <h4>"My New Go-To"</h4>
                    <p>Shipping was incredibly fast and the packaging was an experience in itself.</p>
                    <div class="reviewer">Sarah L. <i class="fa-solid fa-certificate"></i></div>
                </div>
                <div class="review-card">
                    <div class="stars">★★★★☆</div>
                    <h4>"Impeccable Fit"</h4>
                    <p>Their sizing guide is spot on. Fits exactly how I wanted it to.</p>
                    <div class="reviewer">Michael R. <i class="fa-solid fa-certificate"></i></div>
                </div>
                <div class="review-card">
                    <div class="stars">★★★★★</div>
                    <h4>"Stunning Pieces"</h4>
                    <p>Pictures don't do justice. These pieces are even better in person.</p>
                    <div class="reviewer">Elena K. <i class="fa-solid fa-certificate"></i></div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('show');
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.section-pad').forEach((el) => {
            el.classList.add('hidden');
            observer.observe(el);
        });

        // AJAX Add to Cart Logic
        const forms = document.querySelectorAll('.ajax-cart-form');
        forms.forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault(); 
                
                const productId = this.dataset.id;
                const prefix = this.dataset.prefix || '';
                const sourceImg = document.getElementById(`img-${prefix}${productId}`);
                const cartIcon = document.querySelector('.fa-bag-shopping');
                
                if (sourceImg && cartIcon) {
                    const flyingImg = sourceImg.cloneNode();
                    flyingImg.classList.add('flying-img');
                    
                    const startRect = sourceImg.getBoundingClientRect();
                    const endRect = cartIcon.getBoundingClientRect();
                    
                    flyingImg.style.width = startRect.width + 'px';
                    flyingImg.style.height = startRect.height + 'px';
                    flyingImg.style.top = startRect.top + 'px';
                    flyingImg.style.left = startRect.left + 'px';
                    
                    document.body.appendChild(flyingImg);
                    
                    void flyingImg.offsetWidth; 
                    
                    flyingImg.style.top = (endRect.top + 5) + 'px';
                    flyingImg.style.left = (endRect.left + 5) + 'px';
                    flyingImg.style.width = '20px';
                    flyingImg.style.height = '20px';
                    flyingImg.style.opacity = '0';
                    
                    setTimeout(() => {
                        flyingImg.remove();
                        cartIcon.parentElement.style.transform = 'scale(1.2)';
                        cartIcon.parentElement.style.transition = 'transform 0.2s';
                        setTimeout(() => cartIcon.parentElement.style.transform = 'scale(1)', 200);
                    }, 1200);
                }
                
                const formData = new FormData(this);
                fetch("{{ url_for('store_cart') }}", {
                    method: 'POST',
                    body: formData,
                    headers: { 'X-Requested-With': 'XMLHttpRequest' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        let badge = document.querySelector('.nav-icon .badge');
                        if (!badge) {
                            badge = document.createElement('span');
                            badge.className = 'badge';
                            document.querySelector('.fa-bag-shopping').parentElement.appendChild(badge);
                        }
                        badge.textContent = data.cart_count;
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    });

    // Looping Product Image Script
    document.addEventListener("DOMContentLoaded", function() {
        const images = document.querySelectorAll('.looping-image');
        const staticPath = "{{ url_for('static', filename='product_images/') }}";
        
        images.forEach(img => {
            if (!img.dataset.photos) return;
            const rawPhotos = img.dataset.photos.split('|');
            if (rawPhotos.length <= 1) return;
            
            const photos = rawPhotos.map(p => {
                let clean = p.trim();
                return clean.startsWith('http') ? clean : staticPath + clean;
            });

            let idx = 0;
            setInterval(() => {
                idx = (idx + 1) % photos.length;
                img.style.opacity = 0.8; 
                setTimeout(() => {
                    img.src = photos[idx];
                    img.style.opacity = 1;
                }, 200);
            }, 3000 + Math.random() * 1000);
        });
    });
</script>

<style>
    /* UTILS */
    :root { --bg-light: #f9f9f9; --text-dark: #111; --muted: #777; --gold: #FFD700; }
    .bg-white { background: #fff; } .bg-light { background: var(--bg-light); } .text-center { text-align: center; } 
    .mb-10 { margin-bottom: 10px; } .mb-40 { margin-bottom: 40px; } .mb-50 { margin-bottom: 50px; }
    .text-muted { color: var(--muted); font-size: 14px; }
    .section-pad { padding: 80px 0; }
    .header-flex { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 35px; }
    
    /* ANIMATIONS */
    .hidden { opacity: 0; transform: translateY(30px); transition: all 0.8s ease; }
    .show { opacity: 1; transform: translateY(0); }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slowZoom { from { transform: scale(1); } to { transform: scale(1.1); } }
    @keyframes scrollInfinite { 0% { transform: translateX(0); } 100% { transform: translateX(-33.33%); } }
    @keyframes scrollReviews { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
    .animate-up { animation: fadeInUp 1s ease backwards 0.3s; }

    /* TYPOGRAPHY */
    .section-title { font-size: 32px; font-weight: 800; text-transform: uppercase; letter-spacing: -1px; margin: 0; line-height: 1; color: var(--text-dark); }
    .view-all-link { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: black; text-decoration: none; position: relative; padding-bottom: 2px; }
    .view-all-link::after { content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0; background-color: #000; transition: width 0.3s ease; }
    .view-all-link:hover::after { width: 100%; }

    /* HERO & MARQUEE */
    .hero-btn { background: white; color: black; padding: 15px 40px; font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; display: inline-block; }
    .hero-btn:hover { background: black; color: white; transform: translateY(-2px); }
    .marquee-container { background: black; color: white; padding: 14px 0; overflow: hidden; }
    .marquee-track { display: flex; white-space: nowrap; animation: scrollInfinite 30s linear infinite; }
    .marquee-item { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; padding: 0 3vw; }

    /* PRODUCT GRID */
    .static-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
    .product-card { background: transparent; transition: transform 0.3s ease; border-radius: 4px; }
    .product-card:hover { transform: translateY(-5px); }
    .card-image-wrap { position: relative; aspect-ratio: 4/5; background: #f0f0f0; overflow: hidden; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); transition: 0.3s; }
    .product-card:hover .card-image-wrap { box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
    .card-image-wrap img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.7s ease; }
    .product-card:hover img { transform: scale(1.08); }

    .card-info { padding: 16px 0; display: block; text-align: center; }
    .card-cat { font-size: 10px; font-weight: 700; text-transform: uppercase; color: #999; margin-bottom: 6px; letter-spacing: 1px; }
    .card-name { font-size: 15px; font-weight: 700; margin: 0 0 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-dark); letter-spacing: -0.2px; }
    .card-rating { font-size: 10px; color: var(--gold); }
    .card-sold { font-weight: 700; color: #777; margin-left: 5px; } 
    .card-meta { display: flex; justify-content: center; align-items: center; gap: 5px; font-size: 10px; margin-bottom: 8px; }
    .card-price { font-size: 14px; font-weight: 800; color: var(--text-dark); }

    .quick-add-icon { position: absolute; bottom: 15px; right: 15px; width: 36px; height: 36px; border-radius: 50%; background: white; color: black; border: none; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; opacity: 0; transform: translateY(10px) scale(0.9); transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .quick-add-icon:hover { background: black; color: white; }
    .product-card:hover .quick-add-icon { opacity: 1; transform: translateY(0) scale(1); }

    .badge-new, .badge-hot { position: absolute; top: 10px; left: 10px; padding: 4px 8px; font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: white; border-radius: 2px; }
    .badge-new { background: #000; } .badge-hot { background: #e11d48; }

    /* ========================================================= */
    /* THE TIGHTER, MORE PREMIUM BENTO BOX */
    /* ========================================================= */
    
    /* Reduced width for a more elegant, magazine-like inset feel */
    .bento-container {
        max-width: 1150px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .editorial-bento {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-auto-rows: 280px; /* Reduced from 350px so they aren't so massive */
        gap: 20px;
    }

    /* BENTO MAPPING RULES */
    .feature-main { grid-column: span 2; grid-row: span 2; } /* Left side */
    .feature-horizontal { grid-column: span 2; grid-row: span 1; } /* Top right */
    .feature-square { grid-column: span 1; grid-row: span 1; } /* Bottom right splits */
    
    .ed-item {
        position: relative;
        overflow: hidden;
        border-radius: 4px;
        display: block;
        background: #000;
        cursor: pointer;
    }

    .ed-image-wrap {
        position: absolute; inset: 0;
        transition: transform 1.2s cubic-bezier(0.19, 1, 0.22, 1);
    }

    .ed-item img {
        width: 100%; height: 100%; object-fit: cover;
        opacity: 0.85; transition: opacity 0.6s ease;
    }

    .ed-overlay {
        position: absolute; inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, transparent 60%);
        display: flex; flex-direction: column; justify-content: flex-end;
        padding: 30px; /* Scaled down padding for smaller boxes */
        color: white;
        transition: background 0.6s ease;
    }

    .ed-content h3 {
        font-size: 26px; /* Scaled down slightly */
        font-weight: 800; text-transform: uppercase;
        margin: 0 0 10px; letter-spacing: -0.5px; line-height: 1.1;
        transform: translateY(30px); /* Tuned for new box height */
        transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1);
    }

    .ed-content p {
        font-size: 13px; /* Scaled down slightly */
        color: #ddd; margin: 0 0 20px; font-weight: 500;
        opacity: 0; transform: translateY(20px);
        transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
    }

    .ed-link {
        font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px;
        display: inline-flex; align-items: center; gap: 8px;
        opacity: 0; transform: translateY(20px);
        transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
    }

    .ed-link i { font-size: 14px; transition: transform 0.3s ease; }

    /* Hover Effects */
    .ed-item:hover .ed-image-wrap { transform: scale(1.05); }
    .ed-item:hover img { opacity: 0.6; }
    .ed-item:hover .ed-overlay { background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, transparent 70%); }
    .ed-item:hover .ed-content h3 { transform: translateY(0); }
    .ed-item:hover .ed-content p, 
    .ed-item:hover .ed-link { transform: translateY(0); opacity: 1; }
    .ed-item:hover .ed-link i { transform: translateX(5px); }

    /* Small Box Tuning */
    .feature-square .ed-overlay { padding: 20px; } 
    .feature-square .ed-content h3 { font-size: 20px; transform: translateY(25px); }
    .feature-square .ed-content p { display: none; }


    /* REVIEWS */
    .reviews-marquee-container { overflow: hidden; padding: 30px 0; }
    .reviews-track { display: flex; width: max-content; animation: scrollReviews 80s linear infinite; }
    .reviews-track:hover { animation-play-state: paused; }
    .review-card { width: 360px; background: white; padding: 40px; margin: 0 15px; border-radius: 8px; text-align: left; box-shadow: 0 10px 30px rgba(0,0,0,0.03); border: 1px solid #f0f0f0; }
    .stars { color: var(--gold); letter-spacing: 2px; font-size: 14px; margin-bottom: 15px; }
    .review-card h4 { font-size: 18px; font-weight: 800; margin: 0 0 12px; color: var(--text-dark); }
    .review-card p { font-size: 15px; line-height: 1.6; color: #555; font-style: italic; margin-bottom: 25px; }
    .reviewer { font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; color: #111; }
    .reviewer i { color: #2563eb; }

    /* RESPONSIVE BREAKPOINTS */
    @media (max-width: 1024px) { 
        .editorial-bento { grid-template-columns: repeat(2, 1fr); grid-auto-rows: 280px; }
        .feature-main { grid-column: span 2; grid-row: span 2; }
        .feature-horizontal { grid-column: span 2; grid-row: span 1; }
        .feature-square { grid-column: span 1; grid-row: span 1; }
        .static-grid { grid-template-columns: repeat(2, 1fr); } 
    }
    @media (max-width: 600px) { 
        .editorial-bento { grid-template-columns: 1fr; grid-auto-rows: 250px; }
        .feature-main, .feature-horizontal, .feature-square { grid-column: span 1; grid-row: span 1; }
        .static-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}